sqlxì˜ ì¿¼ë¦¬ ë§¤í¬ë¡œ(query!, query_as! ë“±)ëŠ” ì»´íŒŒì¼ íƒ€ì„ì— ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•´ SQL ì¿¼ë¦¬ë¥¼ ì •ì ìœ¼ë¡œ ê²€ì¦í•©ë‹ˆë‹¤.
ì´ë¥¼ ìœ„í•´ ì»´íŒŒì¼ ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ì •ë³´ê°€ í•„ìš”í•˜ê³ , ê¸°ë³¸ì ìœ¼ë¡œ DATABASE_URL í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
ë˜ëŠ” cargo sqlx prepare ëª…ë ¹ì„ ì‹¤í–‰í•´ ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ì¤€ë¹„í•´ ìºì‹œ(sqlx-data.json)ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
ì´ íŒŒì¼ì´ ìˆìœ¼ë©´ ì»´íŒŒì¼ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì—†ì´ë„ ì¿¼ë¦¬ ê²€ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.


match armsì˜ íƒ€ì… ê·œì¹™ì´ ë‹¤ë¥¸ê°€?
    -> imple TraitëŠ” **ì–´ë–¤ êµ¬ì²´ íƒ€ì…ì¸ì§€ ìˆ¨ê¸´ë‹¤** ëŠ” ê²ƒì´ ëª©ì ì´ë¯€ë¡œ, ì»´íŒŒì¼ëŸ¬ë„ ê·¸ íƒ€ì…ì´ ì •í™•íˆ ë­”ì§€ ëª¨ë¥¸ë‹¤. ë”°ë¼ì„œ ì„œë¡œ ë‹¤ë¥¸ impl TraitëŠ” ê°™ì€ íƒ€ì…ì¸ì§€ í™•ì´í•  ë°©ë²•ì´ ì—†ë‹¤.
íŠ¹ì§• / êµ¬ì²´ íƒ€ì…(Concrete Type)        VS        ë¶ˆíˆ¬ëª… íƒ€ì…(Opaque Type)
ì»´íŒŒì¼ëŸ¬ ì¸ì‹ / ì •í™•í•œ íƒ€ì… ì•Œê³  ìˆìŒ                   ë­”ê°€ íŠ¸ë ˆì´íŠ¸ êµ¬í˜„í•œ ê²ƒ
íƒ€ì… ë¹„êµ /    ì •í™•íˆ ë¹„êµ ê°€ëŠ¥                       ë¹„êµ ë¶ˆê°€ëŠ¥
match arms / âœ… ê°™ì€ íƒ€ì…ì´ë©´ OK                    âŒ ê°ê° ë‹¤ë¥¸ ë¶ˆíˆ¬ëª… íƒ€ì…
ì˜ˆì‹œ /        Ordering, Decimal                  impl Subscriber
í•´ê²°ì±… /       í•„ìš” ì—†ìŒ                            Box<dyn> ë˜ëŠ” ë¶„ë¦¬
ì˜ˆì™¸ continueì™€ !(never type)ì˜ íŠ¹ë³„ í•œ ê²½ìš°
    -> continueì˜ íƒ€ì…ì€ !(never. type) !ì˜ ì˜ë¯¸ëŠ” "ì´ ì½”ë“œëŠ” ì ˆëŒ€ ë°˜í™˜í•˜ì§€ ì•ŠìŒ"ì„ ì˜ë¯¸ !ëŠ” ëª¨ë“  íƒ€ì…ìœ¼ë¡œ ê°•ì œ ë³€í™˜(coercion) ê°€ëŠ¥


Rustì˜ Actix-webì—ì„œ ì •ì  íŒŒì¼ ë¼ìš°íŠ¸ë¥¼ ë™ì  ë¼ìš°íŠ¸ë³´ë‹¤ ë¨¼ì € ë“±ë¡í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ë¼ìš°íŠ¸ ë§¤ì¹­ ìˆœì„œ ë•Œë¬¸ì…ë‹ˆë‹¤.
í•µì‹¬ ì´ìœ 
Actix-webì€ ë“±ë¡ëœ ìˆœì„œëŒ€ë¡œ ë¼ìš°íŠ¸ë¥¼ ë§¤ì¹­í•©ë‹ˆë‹¤. ë¨¼ì € ë“±ë¡ëœ ë¼ìš°íŠ¸ê°€ ìš”ì²­ê³¼ ì¼ì¹˜í•˜ë©´, ê·¸ ì¦‰ì‹œ í•´ë‹¹ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ê³  ì´í›„ ë¼ìš°íŠ¸ëŠ” í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë¼ìš°íŒ… ìš°ì„ ìˆœìœ„ ì›ì¹™
1) êµ¬ì²´ì ì¸ ê²½ë¡œ â†’ ì¼ë°˜ì ì¸ ê²½ë¡œ ìˆœì„œë¡œ ë“±ë¡
2) ì •ì  â†’ ë™ì  ìˆœì„œë¡œ ë“±ë¡
3) Catch-all(default_service)ì€ í•­ìƒ ë§ˆì§€ë§‰
ì´ë ‡ê²Œ í•˜ë©´ /css/style.cssëŠ” ì •ì  íŒŒì¼ ì„œë¹„ìŠ¤ê°€ ì²˜ë¦¬í•˜ê³ , /tracing_basicì€ ë™ì  í•¸ë“¤ëŸ¬ê°€ ì²˜ë¦¬í•˜ë©°, ê·¸ ì™¸ëŠ” 404 í•¸ë“¤ëŸ¬ê°€ ì²˜ë¦¬í•©ë‹ˆë‹¤.


let nicknameChecked = false;

// ë³„ëª… ì¤‘ë³µ í™•ì¸
async function checkNickname() {
    const nickname = document.getElementById('nickname').value.trim();
    const statusEl = document.getElementById('nicknameStatus');
    
    if (!nickname) {
        statusEl.textContent = 'ë³„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        statusEl.style.color = 'var(--rust-orange)';
        return;
    }

    try {
        // ì‹¤ì œ API í˜¸ì¶œ (ì˜ˆì‹œ)
        // const response = await fetch(`/api/check-nickname?nickname=${nickname}`);
        // const data = await response.json();
        
        // ì„ì‹œ ì‹œë®¬ë ˆì´ì…˜
        const isAvailable = Math.random() > 0.5;
        
        if (isAvailable) {
            statusEl.textContent = 'âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ë³„ëª…ì…ë‹ˆë‹¤.';
            statusEl.style.color = '#059669';
            nicknameChecked = true;
        } else {
            statusEl.textContent = 'âœ— ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë³„ëª…ì…ë‹ˆë‹¤.';
            statusEl.style.color = 'var(--rust-orange)';
            nicknameChecked = false;
        }
    } catch (error) {
        statusEl.textContent = 'í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        statusEl.style.color = 'var(--rust-orange)';
        nicknameChecked = false;
    }
}

// ë³„ëª… ì…ë ¥ ì‹œ ì¤‘ë³µí™•ì¸ ìƒíƒœ ë¦¬ì…‹
document.getElementById('nickname').addEventListener('input', function() {
    nicknameChecked = false;
    document.getElementById('nicknameStatus').textContent = '';
});

// ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸°
function togglePasswordVisibility() {
    const passwordInput = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.textContent = 'ğŸ™ˆ ìˆ¨ê¸°ê¸°';
    } else {
        passwordInput.type = 'password';
        toggleIcon.textContent = 'ğŸ‘ï¸ ë³´ê¸°';
    }
}

// ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
document.getElementById('passwordConfirm').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const passwordConfirm = this.value;
    const matchEl = document.getElementById('passwordMatch');
    
    if (!passwordConfirm) {
        matchEl.textContent = '';
        return;
    }
    
    if (password === passwordConfirm) {
        matchEl.textContent = 'âœ“ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.';
        matchEl.style.color = '#059669';
    } else {
        matchEl.textContent = 'âœ— ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        matchEl.style.color = 'var(--rust-orange)';
    }
});

// íšŒì›ê°€ì… ì²˜ë¦¬
async function handleSignup(event) {
    event.preventDefault();
    
    // ë³„ëª… ì¤‘ë³µí™•ì¸ ì—¬ë¶€
    if (!nicknameChecked) {
        alert('ë³„ëª… ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
    const password = document.getElementById('password').value;
    const passwordConfirm = document.getElementById('passwordConfirm').value;
    
    if (password !== passwordConfirm) {
        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
    }
    
    // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
    const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
    if (!passwordRegex.test(password)) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ë©°, ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
    }
    
    const formData = {
        email: document.getElementById('email').value,
        name: document.getElementById('name').value,
        nickname: document.getElementById('nickname').value,
        password: password
    };
    
    console.log('íšŒì›ê°€ì… ë°ì´í„°:', formData);
    
    try {
        // ì‹¤ì œ API í˜¸ì¶œ
        // const response = await fetch('/api/signup', {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' },
        //     body: JSON.stringify(formData)
        // });
        
        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        window.close();
    } catch (error) {
        alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}